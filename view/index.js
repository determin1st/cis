// Generated by LiveScript 1.5.0
'use strict';
w3ui && w3ui.ready(function(){
  var M, V, P;
  M = w3ui.PROXY({
    nav: [
      {
        id: 'wa'
      }, {
        id: 'view'
      }, {
        id: 'menu'
      }, {
        id: ''
      }, {
        id: ''
      }
    ],
    sav: [{}, {}, {}, {}],
    authorized: true
  }, {
    init: function(obj){
      var a;
      a = obj.nav;
      obj.sav.forEach(function(save, level){
        save[''] = w3ui.CLONE(a.slice(level + 1));
      });
      return obj;
    },
    set: function(obj, k, v, prx){
      var a, nav, sav, i$, to$, b, len$, c;
      a = parseInt(k);
      if (isNaN(a)) {
        obj[k] = v;
        return true;
      }
      k = a;
      nav = obj.nav;
      a = nav[k];
      sav = k < obj.sav.length ? obj.sav[k] : null;
      if (a.id === v && v === '') {
        return true;
      }
      if (a.id === v) {
        v = '';
      }
      if (sav) {
        k++;
        sav[a.id] = w3ui.CLONE(nav.slice(k));
        for (i$ = k, to$ = nav.length - 1; i$ <= to$; ++i$) {
          b = i$;
          w3ui.clearObject(nav[b]);
        }
        sav = sav[v]
          ? sav[v]
          : sav[''];
        for (i$ = 0, len$ = sav.length; i$ < len$; ++i$) {
          c = i$;
          b = sav[i$];
          import$(nav[k + c], sav[c]);
        }
      }
      a.id = v;
      return true;
    },
    get: function(obj, p, prx){
      var k;
      k = parseInt(p);
      if (!isNaN(k)) {
        return obj.nav[k].id;
      }
      if (p in obj) {
        return obj[p];
      }
      return null;
    }
  });
  V = {
    init: function(model){
      var template, init, render, attach, this$ = this;
      this.animation = this.animation();
      this.el.$data = this.ui;
      this.el.$model = model;
      template = document.querySelector('template').content;
      init = function(id, node, parent, level, tid){
        var cfg, a, b, own$ = {}.hasOwnProperty;
        cfg = node.cfg;
        if (level > 0) {
          tid = tid + '-' + id;
        }
        cfg.id = id;
        cfg.parent = parent;
        cfg.level = level;
        cfg.nav = model.nav[level];
        if (cfg.render !== undefined) {
          cfg.render = render.bind(node, cfg.render);
        }
        if (cfg.attach) {
          cfg.attach = attach.bind(node, cfg.attach);
        }
        cfg.template = template.querySelector(tid);
        cfg.data = {};
        cfg.show && this$.animation.init(node, cfg.show);
        cfg.hide && this$.animation.init(node, cfg.hide);
        if (cfg.turn) {
          if (cfg.turn.on) {
            this$.animation.init(node, cfg.turn.off);
            this$.animation.init(node, cfg.turn.on);
          } else {
            this$.animation.init(node, cfg.turn);
          }
        }
        for (a in node) if (own$.call(node, a)) {
          b = node[a];
          if (a !== 'cfg' && b && b.cfg) {
            init(a, b, node, level + 1, tid);
          }
        }
        return true;
      };
      render = function(template, old){
        var id, a, b, c, d;
        old == null && (old = '');
        id = this.cfg.nav.id;
        if (!this.cfg.node) {
          this.cfg.node = w3ui('#' + this.cfg.id);
        }
        a = this.cfg.parent;
        b = !a || a.cfg.nav.id === this.cfg.id ? id : '';
        if (!b && id && (c = a[a.cfg.nav.id][id])) {
          this.cfg.context = c;
        }
        if (!template || !id) {
          return true;
        }
        if (!this.cfg.node) {
          return false;
        }
        if (b) {
          a = this[id].cfg.template.innerHTML;
          c = this[id];
        } else {
          a = (a = this.cfg.template.querySelector('#' + id)) ? a.innerHTML : '';
          c = this[id] ? this[id].render.call(this) : null;
        }
        if (!(a = Mustache.render(a, c))) {
          return true;
        }
        d = document.createElement('template');
        d.innerHTML = a.trim();
        c = b
          ? w3ui('#' + b, d.content)
          : w3ui('', d.content);
        c.style.display = 'none';
        if (old) {
          this.cfg.node.child.insert(c);
        } else {
          this.cfg.node.child.remove();
          this.cfg.node.child.add(c);
        }
        if (b) {
          this[id].cfg.node = c;
        } else {
          this[id].node = c;
        }
        return true;
      };
      attach = function(event){
        var a, b, x, e, i$, len$, d, c, ref$, own$ = {}.hasOwnProperty;
        if (!this.cfg.node) {
          return true;
        }
        if (event === true) {
          if (!(a = this.cfg.nav.id) || !(b = this[a])) {
            return true;
          }
          event = b.attach;
        }
        x = /^key.+/;
        e = [];
        for (a in event) if (own$.call(event, a)) {
          b = event[a];
          if (!Array.isArray(b)) {
            b = [b];
          }
          for (i$ = 0, len$ = b.length; i$ < len$; ++i$) {
            d = b[i$];
            c = d.el
              ? document.querySelectorAll('#' + this.cfg.id + ' ' + d.el)
              : d.el === ''
                ? [this.cfg.node]
                : [document];
            d.preventDefault = !x.test(a);
            d = P.event.bind(this, d);
            e.push([c, a, d]);
          }
        }
        if (!e.length) {
          return true;
        }
        this.cfg.detach = function(){
          var i$, ref$, len$, ref1$, a, b, c;
          for (i$ = 0, len$ = (ref$ = e).length; i$ < len$; ++i$) {
            ref1$ = ref$[i$], a = ref1$[0], b = ref1$[1], c = ref1$[2];
            a.forEach(fn$);
          }
          delete this.detach;
          return true;
          function fn$(a){
            a.removeEventListener(b, c);
          }
        };
        this.cfg.detach.data = {};
        for (i$ = 0, len$ = e.length; i$ < len$; ++i$) {
          ref$ = e[i$], a = ref$[0], b = ref$[1], c = ref$[2];
          a.forEach(fn$);
        }
        return true;
        function fn$(a){
          a.addEventListener(b, c);
        }
      };
      return init('ui', this.ui, null, 0, '#t');
    },
    animation: function(){
      var api, apiHandler, addTweens, this$ = this;
      api = {
        pauseAll: function(){
          var a;
          a = this;
          do {
            a.pause();
          } while (a = a.timeline);
        },
        resumeAll: function(){
          var a;
          a = this;
          do {
            if (!a.isActive()) {
              a.resume();
            }
          } while (a = a.timeline);
        },
        removeAtLabel: function(label){
          var a, b, i$, len$, c, results$ = [];
          if ((a = this.getLabelTime(label)) === -1) {
            return;
          }
          b = this.getChildren(false, true, true, a);
          for (i$ = 0, len$ = b.length; i$ < len$; ++i$) {
            c = b[i$];
            if (c.startTime() === a) {
              console.log('found a tween to remove at [' + label + ']');
              results$.push(this.remove(c));
            }
          }
          return results$;
        }
      };
      apiHandler = {
        get: function(obj, key){
          if (api[key]) {
            return api[key].bind(obj);
          }
          return Reflect.get(obj, key);
        }
      };
      addTweens = function(node, timeline, source){
        if ('w3ui' in node) {
          node = node.w3ui.group;
        }
        source && source.forEach(function(a){
          var pos, b;
          switch (typeof a) {
          case 'object':
            if (a.enabled === false) {
              break;
            }
            if (a.node) {
              node = a.node;
            }
            pos = a.position ? a.position : '+=0';
            if (a.label) {
              timeline.addLabel(a.label, pos);
              break;
            }
            if (a.func) {
              timeline.add(a.func, pos);
              break;
            }
            if (a.group) {
              b = new TimelineLite({
                paused: true
              });
              addTweens(node, b, a.group);
              if (a.duration) {
                b.duration(a.duration);
              }
              timeline.add(b.play(), pos);
              break;
            }
            if (!a.to && !a.from) {
              break;
            }
            b = [a.to ? w3ui.CLONE(a.to) : null, a.from ? w3ui.CLONE(a.from) : null];
            if (!a.duration || a.duration < 0.0001) {
              timeline.set(node, b[0] || b[1], pos);
              break;
            }
            if (b[0] && !b[1]) {
              timeline.to(node, a.duration, b[0], pos);
              break;
            }
            if (!b[0] && b[1]) {
              timeline.from(node, a.duration, b[1], pos);
              break;
            }
            timeline.fromTo(node, a.duration, b[0], b[1], pos);
            break;
          case 'function':
            if (a.length) {
              b = new Proxy(timeline, apiHandler);
              timeline.addPause('+=0', a, [b]);
            } else {
              timeline.add(a);
            }
            break;
          case 'string':
            timeline.addLabel(a);
          }
        });
      };
      return {
        init: function(node, tweens){
          var i$, len$, b, a;
          for (i$ = 0, len$ = tweens.length; i$ < len$; ++i$) {
            b = i$;
            a = tweens[i$];
            if (typeof a === 'function') {
              tweens[b] = a.bind(node);
              continue;
            }
            if (a.func) {
              tweens[b].func = a.func.bind(node);
              continue;
            }
            if (a.group) {
              this.init(node, a.group);
            }
          }
        },
        queue: function(node, queue){
          var a;
          a = new TimelineLite({
            paused: true
          });
          addTweens(node, a, queue);
          return a;
        },
        hide: function(id, onComplete){
          var list, a, b;
          if (!id || !(list = this$.list(id)) || !list.length) {
            onComplete();
            return;
          }
          list = list.slice(1);
          list.reverse();
          a = new TimelineLite({
            paused: true
          });
          b = '';
          list.forEach(function(node){
            var c;
            if (!(node = this.cfg.node)) {
              return;
            }
            c = new TimelineLite({
              paused: true
            });
            addTweens(node, c, this.cfg.hide);
            if (!b || b !== 'L' + this.cfg.level) {
              b = 'L' + this.cfg.level;
              a.addLabel(b);
            }
            a.add(c.play(), b);
          });
          a.add(onComplete);
          a.play();
        },
        show: function(id1, id0, onComplete){
          var x, node, parent, c, list, a, b;
          x = new TimelineLite({
            paused: true
          });
          x.addLabel('start');
          node = this$.el[id1].cfg;
          parent = node.parent;
          if (id0 && (c = parent.cfg.parent)) {
            list = [parent];
            for (a in c) {
              b = c[a];
              if (a !== 'cfg' && b.cfg) {
                if (!b.cfg.node || a === parent.cfg.id) {
                  continue;
                }
                list.push(b);
              }
            }
            list.forEach(function(parent){
              var el0, el1, turn, flag, a, old;
              el0 = parent[id0];
              el1 = parent[id1];
              turn = parent.cfg.turn;
              flag = !!parent.cfg.context;
              if (flag && (!el0 || !el0.render) && (!el1 || !el1.render)) {
                if (turn) {
                  a = new TimelineLite({
                    paused: true
                  });
                  addTweens(parent.cfg.node, a, turn);
                  x.add(a.play(), 'start');
                }
                return;
              }
              if (flag) {
                if (el0) {
                  old = el0.node;
                }
              } else {
                el0 = el0.cfg;
                el1 = el1.cfg;
                old = parent.cfg.node.query('#' + id0, 0, true)[0];
              }
              if (!turn) {
                old && x.add(function(){
                  parent.cfg.node.child.remove(old);
                  if (el0.node) {
                    delete el0.node;
                  }
                });
                return;
              }
              turn = {
                on: el1 && el1.turn
                  ? el1.turn.on
                  : turn.on,
                off: el0 && el0.turn
                  ? el0.turn.off
                  : turn.off
              };
              if (el1) {
                !flag && x.add(function(){
                  el1.node.style.display = null;
                }, 'start');
                a = new TimelineLite({
                  paused: true
                });
                addTweens(el1.node, a, turn.on);
                x.add(a.play(), 'start');
              }
              if (old) {
                a = new TimelineLite({
                  paused: true
                });
                addTweens(old, a, turn.off);
                x.add(a.play(), 'start');
                x.add(function(){
                  parent.cfg.node.child.remove(old);
                  delete el0.node;
                });
              }
            });
          }
          list = this$.list(id1);
          if (id0) {
            list = list.slice(1);
          }
          list = list.reduce(function(a, b){
            if (b.cfg.node) {
              a.push(b);
            }
            return a;
          }, []);
          a = '';
          list.forEach(function(elem){
            var b, c;
            b = elem.cfg;
            c = new TimelineLite({
              paused: true
            });
            c.add(function(){
              var c;
              if (b.context) {
                c = elem[b.nav.id];
                if (c) {
                  c.node.style.display = null;
                }
              } else {
                b.node.style.display = null;
              }
            });
            addTweens(b.node, c, b.show);
            if (!a || a !== 'L' + b.level) {
              a = 'L' + b.level;
              c.addLabel(a);
            }
            x.add(c.play(), a);
          });
          x.add(onComplete);
          x.play();
        }
      };
    },
    el: w3ui.PROXY(null, {
      get: function(obj, id, prx){
        var root, a, b, k, v, own$ = {}.hasOwnProperty;
        if (obj.cfg.id === id) {
          return obj;
        }
        if (!(root = prx.$model[0])) {
          return null;
        }
        if (!(obj = obj[root])) {
          return null;
        }
        if (!id || obj.cfg.id === id) {
          return obj;
        }
        if (obj[id] && obj[id].cfg) {
          return obj[id];
        }
        a = [obj];
        while (a.length) {
          b = a.pop();
          for (k in b) if (own$.call(b, k)) {
            v = b[k];
            if (k !== 'cfg' && v && v.cfg) {
              if (v[id] && v[id].cfg) {
                return v[id];
              }
              a.push(v);
            }
          }
        }
        return null;
      }
    }),
    list: function(id){
      var x, a, b;
      x = [];
      if (!(a = this.el[id])) {
        return x;
      }
      b = [a];
      while (b.length) {
        x.push(b);
        b = b.map(fn$);
        b = b.reduce(fn1$, []);
      }
      x = x.reduce(function(a, b){
        return a.concat(b);
      }, []);
      return x;
      function fn$(node){
        var c, a, b;
        c = [];
        for (a in node) {
          b = node[a];
          if (a !== 'cfg' && b && b.cfg) {
            c.push(b);
          }
        }
        return c;
      }
      function fn1$(a, b){
        return a.concat(b);
      }
    },
    call: function(method, id){
      var param, res$, i$, to$, me, opts, list;
      id == null && (id = '');
      res$ = [];
      for (i$ = 2, to$ = arguments.length; i$ < to$; ++i$) {
        res$.push(arguments[i$]);
      }
      param = res$;
      me = this.call;
      !me.opts && (me.opts = {
        render: {
          active: false
        },
        init: {
          active: true,
          cleanup: true
        },
        resize: {
          active: true
        },
        refresh: {
          active: true
        },
        attach: {
          active: true
        },
        detach: {
          active: true,
          reverse: true
        },
        finit: {
          active: false,
          reverse: true
        }
      });
      if (!(opts = me.opts[method])) {
        return false;
      }
      if (!(list = this.list(id))) {
        return false;
      }
      if (opts.reverse) {
        list.reverse();
      }
      list = list.reduce(function(a, node){
        if (node.cfg[method]) {
          a.push(node);
        }
        return a;
      }, []);
      if (opts.cleanup) {
        list.forEach(function(node){
          var a, b;
          a = node.cfg;
          if (!a.node) {
            return;
          }
          b = a.context ? a.context.cfg : a;
          if (b.parent.cfg.nav.id === b.id) {
            return;
          }
          a.node = null;
        });
      }
      if (opts.active) {
        list = list.reduce(function(a, node){
          if (node.cfg.node) {
            a.push(node);
          }
          return a;
        }, []);
        true;
      }
      if (!param.length) {
        param = false;
      }
      return list.every(function(node){
        if (param) {
          return node.cfg[method].apply(node, param);
        } else {
          return node.cfg[method].call(node);
        }
      });
    },
    ui: {
      cfg: {
        id: 'ui',
        node: w3ui('#ui'),
        parent: null,
        context: null,
        data: {},
        level: 0,
        nav: null,
        render: true
      },
      wa: {
        cfg: {
          fontSizeMin: 0,
          fontSizeMax: 0,
          init: function(){
            this.cfg.fontSizeMin = parseInt(this.cfg.node.style.fSizeMin);
            this.cfg.fontSizeMax = parseInt(this.cfg.node.style.fSizeMax);
            return true;
          }
        },
        view: {
          cfg: {
            render: true,
            turn: {
              on: [
                {
                  to: {
                    className: '+=color',
                    opacity: 0,
                    scale: 0.6
                  }
                }, {
                  duration: 0.2,
                  to: {
                    opacity: 0.5
                  }
                }, {
                  duration: 0.6,
                  to: {
                    opacity: 1,
                    scale: 1
                  }
                }, {
                  position: '-=0.1',
                  duration: 0.3,
                  to: {
                    className: '-=color'
                  }
                }
              ],
              off: [
                {
                  duration: 0.2,
                  to: {
                    className: '+=color',
                    scale: 0.9
                  }
                }, {
                  duration: 0.8,
                  to: {
                    scale: 1,
                    opacity: 0
                  }
                }
              ]
            }
          },
          menu: {
            cfg: {
              render: true,
              init: function(){
                var c, d, a, b;
                c = this.cfg;
                d = this.cfg.data;
                if (!d.menu) {
                  d.menu = c.node.query('.box');
                  d.time = c.show[1].duration;
                }
                while ((a = c.nav.current) === undefined) {
                  c.nav.current = 0;
                }
                while (!(b = c.nav.currentItem)) {
                  c.nav.currentItem = this.data.map(fn$);
                }
                d.menu[a].style.visibility = 'visible';
                return true;
                function fn$(){
                  return 0;
                }
              },
              finit: function(){
                w3ui.clearObject(this.cfg.data);
                return true;
              },
              refresh: function(){
                var data, a, i$, to$, b, c, d, e, this$ = this;
                data = this.cfg.data;
                if (!data.box) {
                  a = this.cfg.nav.current;
                  data.box = data.menu[a];
                  data.btn = data.box.query('.button');
                  for (i$ = 0, to$ = data.btn.length - 1; i$ <= to$; ++i$) {
                    b = i$;
                    data.btn[b].dataset.num = b;
                    data.btn[b].dataset.id = this.data[a].list[b].id;
                  }
                  a = this.cfg.nav.currentItem[a];
                  data.btn[a]['class'].add('active');
                }
                if (!data.slide) {
                  a = this.cfg.nav.current || 0;
                  b = data.menu.length - 1;
                  c = [a > 0 ? a - 1 : b, a < b ? a + 1 : 0];
                  a = [[data.menu[a].node, data.menu[c[0]].node], [data.menu[a].node, data.menu[c[1]].node]];
                  c = [['0%', '100%', '-100%', '0%'], ['0%', '-100%', '100%', '0%']];
                  data.slide = a.map(function(a, index){
                    var b;
                    b = new TimelineLite({
                      paused: true,
                      data: {
                        complete: function(){
                          delete data.slide;
                        }
                      }
                    });
                    b.set(a, {
                      transformOrigin: '0% 50%',
                      visibility: 'visible'
                    });
                    b.addLabel('s1');
                    b.fromTo(a[0], data.time, {
                      x: c[index][0]
                    }, {
                      x: c[index][1]
                    }, 's1');
                    b.fromTo(a[1], data.time, {
                      x: c[index][2]
                    }, {
                      x: c[index][3]
                    }, 's1');
                    b.set(a[0], {
                      visibility: 'hidden'
                    });
                    b.set(a[1], {
                      visibility: 'visible'
                    });
                    return b;
                  });
                }
                if (!data.drag) {
                  a = V.el.console.cfg.data.slide;
                  b = data.slide;
                  c = [
                    new TimelineLite({
                      paused: true,
                      ease: Power3.easeInOut
                    }), new TimelineLite({
                      paused: true,
                      ease: Power3.easeInOut
                    })
                  ];
                  d = function(){
                    var a, b;
                    a = 'drag';
                    b = !this$.cfg.node['class'].has(a);
                    this$.cfg.node['class'].toggle(a, b);
                  };
                  e = function(index){
                    return function(){
                      this$.cfg.node['class'].remove('drag');
                      a[index].data.complete();
                      b[index].data.complete();
                      delete data.box;
                      delete data.drag;
                    };
                  };
                  c[0].add(d);
                  c[0].add(a[0].play(), 0);
                  c[0].add(b[0].play(), 0);
                  c[0].add(e(0));
                  c[1].add(d);
                  c[1].add(a[1].play(), 0);
                  c[1].add(b[1].play(), 0);
                  c[1].add(e(1));
                  data.drag = c;
                }
                return true;
              },
              show: [
                {
                  to: {
                    backgroundColor: 'transparent',
                    scale: 0
                  }
                }, {
                  duration: 0.8,
                  to: {
                    scale: 1,
                    clearProps: 'backgroundColor',
                    ease: Back.easeOut
                  }
                }
              ],
              hide: [{
                duration: 0.8,
                to: {
                  scale: 0,
                  ease: Power3.easeIn
                }
              }],
              attach: {
                click: {
                  el: '.button'
                },
                pointerover: {
                  el: '.button'
                },
                pointerdown: {
                  el: ''
                },
                pointermove: {
                  el: ''
                },
                pointerup: {
                  el: ''
                },
                keydown: {
                  keys: ['ArrowUp', 'ArrowDown']
                }
              }
            },
            title: 'Главное меню',
            config: true,
            data: [
              {
                id: 'card',
                name: 'Картотека',
                list: [
                  {
                    id: 'address',
                    name: 'Адреса'
                  }, {
                    id: 'counterparty',
                    name: 'Контрагенты'
                  }
                ]
              }, {
                id: 'income',
                name: 'Входящие',
                list: [
                  {
                    id: 'accrual',
                    name: 'Начисления'
                  }, {
                    id: 'payment',
                    name: 'Оплата'
                  }, {
                    id: 'storno',
                    name: 'Сторно'
                  }
                ]
              }, {
                id: 'outcome',
                name: 'Исходящие',
                list: [
                  {
                    id: 'calc',
                    name: 'Расчеты'
                  }, {
                    id: 'document',
                    name: 'Отчеты'
                  }
                ]
              }
            ]
          },
          address: {
            cfg: {
              refresh: function(){
                return true;
              },
              show: [
                {
                  duration: 0,
                  to: {
                    scale: 0
                  }
                }, {
                  duration: 0.8,
                  to: {
                    scale: 1,
                    ease: Back.easeOut
                  }
                }
              ],
              hide: [{
                duration: 0.8,
                to: {
                  scale: 0,
                  ease: Back.easeIn
                }
              }]
            },
            title: 'Адреса',
            config: true,
            tab: [
              {
                id: 'a0',
                name: 'квартира'
              }, {
                id: 'a1',
                name: 'дом'
              }, {
                id: 'a2',
                name: 'улица'
              }, {
                id: 'a3',
                name: 'район'
              }, {
                id: 'a4',
                name: 'город'
              }
            ]
          },
          payment: {
            cfg: {
              refresh: function(){
                return true;
              }
            },
            title: 'Оплата'
          },
          config: {
            cfg: {
              init: function(){
                return true;
              },
              refresh: function(){
                return true;
              }
            },
            title: 'Конфигурация',
            current: function(){
              return this.cfg.nav.current;
            }
          }
        },
        header: {
          cfg: {
            render: false,
            init: function(){
              var cfg, dat, ctx, id, a, b, c, d;
              cfg = this.cfg;
              dat = cfg.data;
              ctx = cfg.context;
              id = ctx ? ctx.cfg.id : '';
              if (!dat.title) {
                dat.title = cfg.node.query('.title');
                dat.mode = cfg.node.query('.mode .button');
                dat.config = cfg.node.query('.config .button');
              }
              cfg.node['class'].clear('on');
              cfg.node['class'].add(id);
              dat.title.$text = ctx && ctx.title ? ctx.title : '';
              a = id === 'menu' ? 'return' : 'menu';
              dat.mode.$text = this.mode[a];
              dat.mode.$icon = cfg.template.querySelector('#' + a).innerHTML;
              dat.mode.prop['data-id'] = 'mode';
              dat.mode['class'].remove('hovered');
              a = id === 'config' ? 'close' : 'config';
              dat.config.$text = this.config[a];
              dat.config.$icon = cfg.template.querySelector('#' + a).innerHTML;
              dat.config.prop['data-id'] = 'config';
              dat.config['class'].remove('hovered');
              a = [id === 'config', id !== 'config' && (!ctx || !ctx.config)];
              b = [dat.mode.node, dat.config.node];
              c = [];
              if (a[0]) {
                c.push(b[0]);
              }
              if (a[1]) {
                c.push(b[1]);
              }
              d = [];
              if (!a[0]) {
                d.push(b[0]);
              }
              if (!a[1]) {
                d.push(b[1]);
              }
              cfg.show[2].node = b;
              cfg.show[3].enabled = a[0] || a[1];
              cfg.show[3].node = c;
              cfg.show[4].node = dat.title.node;
              cfg.show[6].node = b;
              cfg.hide[1].node = b;
              cfg.hide[2].node = dat.title.node;
              cfg.turn[1].node = dat.title.node;
              cfg.turn[2].node = b;
              cfg.turn[2].group[2].node = d;
              dat.resizeAnim = V.animation.queue(cfg.node, [cfg.hide[1], cfg.show[6]]);
              return true;
            },
            resize: function(noAnimation){
              var cfg, dat, a, c, b;
              noAnimation == null && (noAnimation = false);
              cfg = this.cfg;
              dat = cfg.data;
              a = dat.title.box.fontSize(dat.title.$text);
              c = V.el.wa.cfg;
              b = [c.fontSizeMin, c.fontSizeMax];
              if (a < b[0]) {
                a = 0;
              }
              if (a > b[1]) {
                a = b[1];
              }
              c.node.style.fSize0 = a + 'px';
              a = dat.resizeAnim.isActive();
              if (a) {
                return true;
              }
              dat.useIcon = [dat.mode, dat.config].some(function(a){
                var b;
                if (a.$text && !a['class'].has('disabled')) {
                  b = a.box.textMetrics(a.$text).width;
                  if (a.box.innerWidth < b) {
                    return true;
                  }
                }
                return false;
              });
              b = dat.mode['class'].has('icon');
              if (noAnimation || !(!dat.useIcon !== !b && (dat.useIcon || b))) {
                return true;
              }
              return dat.resizeAnim.play(0);
            },
            show: [
              'beg', {
                position: 'beg',
                duration: 0.4,
                to: {
                  className: 'on',
                  opacity: 1,
                  ease: Power3.easeOut
                }
              }, {
                position: 'beg',
                node: null,
                to: {
                  scale: 0
                }
              }, {
                position: 'beg',
                node: null,
                enabled: false,
                to: {
                  className: '+=disabled'
                }
              }, {
                position: 'beg',
                node: null,
                group: [
                  {
                    to: {
                      opacity: 0,
                      scale: 0.4
                    }
                  }, function(){
                    var a;
                    a = this.cfg.data.title;
                    a.html = a.$text;
                  }, {
                    duration: 0.4,
                    to: {
                      opacity: 1,
                      scale: 1,
                      ease: Back.easeOut
                    }
                  }
                ]
              }, function(){
                this.cfg.resize.call(this, true);
              }, {
                node: null,
                group: [
                  function(){
                    var a, b;
                    a = this.cfg.data;
                    b = a.useIcon ? '$icon' : '$text';
                    a.mode.html = a.mode[b];
                    a.config.html = a.config[b];
                    a.mode.$svg = a.mode.query('svg');
                    a.config.$svg = a.config.query('svg');
                    a.mode['class'].toggle('icon', a.useIcon);
                    a.config['class'].toggle('icon', a.useIcon);
                  }, {
                    duration: 0.4,
                    to: {
                      scale: 1,
                      ease: Back.easeOut
                    }
                  }
                ]
              }
            ],
            hide: [
              'beg', {
                duration: 0.2,
                node: null,
                to: {
                  scale: 0,
                  ease: Power3.easeIn
                }
              }, {
                position: 'beg',
                duration: 0.4,
                node: null,
                to: {
                  scale: 0.2,
                  opacity: 0,
                  ease: Back.easeIn
                }
              }, {
                position: '-=0.2',
                duration: 0.4,
                to: {
                  className: '',
                  ease: Power3.easeIn
                }
              }
            ],
            turn: [
              'beg', {
                position: 'beg',
                node: null,
                group: [
                  {
                    duration: 0.4,
                    to: {
                      opacity: 0,
                      scale: 0.4,
                      ease: Power2.easeIn
                    }
                  }, function(){
                    var a;
                    a = this.cfg.data;
                    a.title.html = a.title.$text;
                  }, {
                    duration: 0.4,
                    to: {
                      opacity: 1,
                      scale: 1,
                      ease: Back.easeOut
                    }
                  }
                ]
              }, {
                position: 'beg',
                node: null,
                group: [
                  {
                    duration: 0.2,
                    to: {
                      opacity: 0,
                      scale: 0,
                      ease: Power2.easeIn
                    }
                  }, function(){
                    var a, b;
                    a = this.cfg.data;
                    b = a.useIcon ? '$icon' : '$text';
                    a.mode.html = a.mode[b];
                    a.config.html = a.config[b];
                    a.mode.$svg = a.mode.query('svg');
                    a.config.$svg = a.config.query('svg');
                    a.mode['class'].toggle('icon', a.useIcon);
                    a.config['class'].toggle('icon', a.useIcon);
                  }, {
                    duration: 0.4,
                    node: null,
                    to: {
                      opacity: 1,
                      scale: 1,
                      ease: Power2.easeOut
                    }
                  }
                ]
              }
            ],
            attach: {
              pointerover: {
                el: '.button',
                id: ''
              },
              pointerout: {
                el: '.button',
                id: ''
              },
              click: [
                {
                  el: '.mode .button',
                  id: 'mode'
                }, {
                  el: '.config .button',
                  id: 'config'
                }
              ]
            }
          },
          mode: {
            'return': 'возврат',
            menu: 'меню'
          },
          config: {
            close: 'закрыть',
            config: 'настройки'
          }
        },
        console: {
          cfg: {
            render: true,
            attach: true,
            init: function(){
              var cfg, id;
              cfg = this.cfg;
              id = cfg.nav.id;
              cfg.node['class'].clear('on');
              cfg.node['class'].add(id);
              return true;
            },
            resize: function(){
              w3ui.clearObject(this.cfg.data);
              return this.cfg.refresh.call(this);
            },
            refresh: function(){
              var a, b;
              a = this.cfg.nav.id;
              b = this[a];
              if (!b || !b.refresh) {
                return true;
              }
              return b.refresh.call(this);
            },
            show: [{
              duration: 0.8,
              to: {
                className: '+=on',
                ease: Power3.easeOut
              }
            }],
            hide: [{
              duration: 0.6,
              to: {
                className: '',
                opacity: 0,
                ease: Power3.easeIn
              }
            }],
            turn: {
              off: [
                {
                  duration: 0.4,
                  to: {
                    opacity: 0
                  }
                }, {
                  to: {
                    display: 'none'
                  }
                }
              ],
              on: [
                {
                  position: 0.4,
                  label: 'beg'
                }, {
                  position: 'beg',
                  to: {
                    opacity: 0,
                    scale: 0.5,
                    clearProps: 'display'
                  }
                }, {
                  position: 'beg',
                  duration: 0.4,
                  to: {
                    opacity: 1,
                    scale: 1
                  }
                }
              ]
            }
          },
          menu: {
            attach: {
              pointerover: [
                {
                  el: '.button.left',
                  id: 'left'
                }, {
                  el: '.button.right',
                  id: 'right'
                }
              ],
              pointerout: [
                {
                  el: '.button.left',
                  id: 'left'
                }, {
                  el: '.button.right',
                  id: 'right'
                }
              ],
              click: [
                {
                  el: '.button.left',
                  id: 'left',
                  delayed: true
                }, {
                  el: '.button.right',
                  id: 'right',
                  delayed: true
                }
              ],
              keydown: {
                keys: ['ArrowLeft', 'ArrowRight', 'Enter'],
                delayed: true
              }
            },
            render: function(){
              var ctx, a, b, c, d;
              ctx = this.cfg.context;
              a = ctx.data;
              b = ctx.cfg.nav.current || 0;
              c = a.length - 1;
              d = this.cfg.data;
              d.list = a.map(function(a){
                return {
                  id: a.id,
                  name: a.name
                };
              });
              d.current = a[b].name;
              d.prev = b
                ? a[b - 1].name
                : a[a.length - 1].name;
              d.next = b === c
                ? a[0].name
                : a[b + 1].name;
              return d;
            },
            refresh: function(){
              var data, a, b, c, main;
              data = this.cfg.data;
              if (!data.node) {
                data.node = this.cfg.node.query('.menu');
                data.time = this.cfg.show[0].duration;
              }
              if (!data.box) {
                data.box = data.node.query('.item');
                data.btn = data.node.query('.button');
              }
              if (!data.hover) {
                a = data.box;
                b = data.btn;
                c = [[a[1].node, b[1].node, a[2].node, b[2].node], [a[3].node, b[3].node, a[2].node, b[2].node]];
                data.hover = c.map(function(c){
                  var d;
                  d = new TimelineLite({
                    paused: true,
                    ease: Power2.easeOut
                  });
                  d.add((function(a, b){
                    return function(){
                      a['class'].remove('hover');
                      b['class'].remove('hover');
                    };
                  }.call(this, a, b)));
                  d.to(c, data.time, {
                    className: '+=hover'
                  });
                  return d;
                });
              }
              if (!data.slide) {
                main = this.cfg.context;
                a = main.cfg.nav.current || 0;
                b = main.data.length - 1;
                c = [
                  a > 1
                    ? a - 2
                    : a - 1 + b, a + 2 <= b
                    ? a + 2
                    : a + 1 - b
                ];
                data.btn[0].html = main.data[c[0]].name;
                data.btn[4].html = main.data[c[1]].name;
                a = [data.box[0].clone(), data.box[4].clone()];
                data.slide = a.map(function(newBox, index){
                  var a, b;
                  a = new TimelineMax({
                    paused: true,
                    data: {
                      complete: function(){
                        var a;
                        data.box.prop.style = null;
                        data.btn.prop.style = null;
                        a = data.node.child;
                        if (index) {
                          a.add(newBox);
                          a.remove(data.box[0]);
                        } else {
                          a.insert(newBox);
                          a.remove(data.box[4]);
                        }
                        delete data.box;
                        delete data.hover;
                        delete data.slide;
                      }
                    }
                  });
                  if (index) {
                    b = [['+=hidden', '-=active', '+=active', '-=hidden'], ['+=hidden', 'button left', 'button center', '-=hidden']];
                  } else {
                    b = [['-=hidden', '+=active', '-=active', '+=hidden'], ['-=hidden', 'button center', 'button right', '+=hidden']];
                  }
                  a.to(data.box[index + 0].node, data.time, {
                    className: b[0][0]
                  }, 0);
                  a.to(data.box[index + 1].node, data.time, {
                    className: b[0][1]
                  }, 0);
                  a.to(data.box[index + 2].node, data.time, {
                    className: b[0][2]
                  }, 0);
                  a.to(data.box[index + 3].node, data.time, {
                    className: b[0][3]
                  }, 0);
                  a.to(data.btn[index + 0].node, data.time, {
                    className: b[1][0]
                  }, 0);
                  a.to(data.btn[index + 1].node, data.time, {
                    className: b[1][1]
                  }, 0);
                  a.to(data.btn[index + 2].node, data.time, {
                    className: b[1][2]
                  }, 0);
                  a.to(data.btn[index + 3].node, data.time, {
                    className: b[1][3]
                  }, 0);
                  return a;
                });
              }
              return true;
            }
          },
          address: {
            render: function(){
              return {};
            }
          },
          payment: {
            render: function(){
              return {};
            }
          }
        }
      }
    }
  };
  P = {
    init: function(){
      if (!V.init(M)) {
        console.log('P.init() failed');
        return false;
      }
      P.construct();
      window.addEventListener('resize', this.resize.bind(this));
      return true;
    },
    construct: function(){
      var busy, lock, nav, id0, id1, level, rid, cancelThread, thread;
      busy = false;
      lock = false;
      nav = null;
      id0 = '';
      id1 = '';
      level = 0;
      rid = '';
      cancelThread = function(msg){
        if (msg) {
          console.log(msg);
        }
        lock = false;
        busy = false;
        return null;
      };
      thread = [
        function(){
          return !busy;
        }, function(){
          var i$, ref$, len$, b, a;
          busy = true;
          if (nav) {
            for (i$ = 0, len$ = (ref$ = nav).length; i$ < len$; ++i$) {
              b = i$;
              a = ref$[i$];
              if (a !== M[b]) {
                id0 = a;
                id1 = M[b];
                level = b;
                break;
              }
            }
          } else {
            id1 = M[0];
          }
          if (id0 === id1) {
            return cancelThread();
          }
          if (!(a = V.el[id1])) {
            M[level] = id0;
            return cancelThread('"' + id1 + '" not found');
          }
          a = a.cfg.parent;
          if (a.cfg.parent) {
            a = a.cfg.parent;
          }
          rid = a.cfg.id;
          if (!V.call('detach')) {
            return cancelThread('detach failed');
          }
          if (id0) {
            lock = true;
            V.animation.hide(id0, function(){
              lock = false;
            });
          }
          if (!V.call('finit', id1)) {
            return cancelThread('finit failed');
          }
          return true;
        }, function(){
          return !lock;
        }, function(){
          if (!V.call('render', rid, id0)) {
            return cancelThread('render failed');
          }
          if (!V.call('init')) {
            return cancelThread('init failed');
          }
          lock = true;
          V.animation.show(id1, id0, function(){
            lock = false;
          });
          return true;
        }, function(){
          return !lock;
        }, function(){
          ['resize', 'refresh', 'attach'].forEach(function(a){
            return V.call(a);
          });
          nav = M.nav.map(function(a){
            return a.id;
          });
          busy = false;
          return true;
        }
      ];
      return function(){
        w3ui.THREAD(thread);
      };
    }(),
    update: function(id){
      id == null && (id = M[0]);
      ['refresh', 'detach', 'attach'].every(function(a){
        return V.call(a, id);
      });
      delete P.event.busy;
    },
    resize: function(force){
      var me, f;
      me = this.resize;
      if (force || !me.timer) {
        if (!V.call('resize')) {
          console.log('resize failed');
        }
      } else {
        window.clearTimeout(me.timer);
        f = me.bind(this);
        me.timer = window.setTimeout(f, 250);
      }
    },
    event: function(data, event){
      var me, a, cfg, nav;
      me = P.event;
      if (data.preventDefault) {
        event.preventDefault();
      }
      if (P.construct.busy || !this.cfg.detach || me.busy && !data.delayed) {
        return true;
      }
      if (me.busy) {
        event.stopPropagation();
        a = !!me.delayed;
        me.delayed = me.bind(this, data, event);
        if (a) {
          return false;
        }
        if (typeof me.busy === 'object') {
          me.busy.timeScale(2);
        }
        w3ui.THREAD([function(){
          if (me.busy) {
            return false;
          }
          me.delayed();
          delete me.delayed;
          return true;
        }]);
        return false;
      }
      cfg = this.cfg;
      nav = this.cfg.nav;
      event.data = data;
      data = cfg.detach.data;
      me.busy = P.react.apply(this, [event, data, cfg, nav]);
      return true;
    },
    react: function(event, data, cfg, nav){
      var a, b, c, d, e, i$, ref$, len$, this$ = this;
      switch (cfg.id) {
      case 'header':
        switch (event.type) {
        case 'pointerover':
          a = event.currentTarget.dataset.id;
          a = this.cfg.data[a];
          if (this.cfg.data.useIcon) {
            a.$svg['class'].add('hovered');
          } else {
            TweenLite.to(a.node, 0.6, {
              className: '+=hovered',
              ease: Power4.easeOut
            });
          }
          break;
        case 'pointerout':
          a = event.currentTarget.dataset.id;
          a = this.cfg.data[a];
          if (this.cfg.data.useIcon) {
            a.$svg['class'].remove('hovered');
          } else {
            TweenLite.to(a.node, 0.4, {
              className: '-=hovered',
              ease: Power4.easeIn
            });
          }
          break;
        case 'click':
          a = event.currentTarget.dataset.id;
          b = this.cfg.nav.id;
          if (a === 'mode' && b === 'menu') {
            break;
          } else if (a === 'config') {
            if (b === 'config') {
              M[this.cfg.level] = M.nav[this.cfg.level + 1].current;
            } else {
              M[this.cfg.level] = 'config';
              M.nav[this.cfg.level + 1].current = b;
            }
          } else {
            M[this.cfg.level] = 'menu';
          }
          P.construct();
        }
        break;
      case 'menu':
        !data.change && (data.change = function(active){
          var a, b;
          a = nav.current || 0;
          b = this$.data.length - 1;
          if (active) {
            a = a > 0 ? a - 1 : b;
          } else {
            a = a < b ? a + 1 : 0;
          }
          nav.current = a;
        });
        switch (event.type) {
        case 'pointerdown':
          a = document.elementFromPoint(event.pageX, event.pageY);
          if (a.className === 'button') {
            break;
          }
          event.stopPropagation();
          data.swipe = event.pointerType !== 'mouse';
          data.size = 0.5 * cfg.node.box.innerWidth;
          data.x = event.pageX;
          data.active = false;
          data.drag = V.el.menu.cfg.data.drag;
          break;
        case 'pointermove':
          if (!data.drag) {
            break;
          }
          event.stopPropagation();
          if ((a = event.pageX - data.x) < 0) {
            b = [0, 1];
          } else {
            b = [1, 0];
          }
          if ((a = Math.abs(a)) < 0.1) {
            if (!data.swipe) {
              break;
            }
            delete data.drag;
            break;
          }
          c = b.map(function(index){
            return data.drag[index];
          });
          a = a / data.size;
          if (a > 0.99) {
            a = 0.99;
          }
          if (data.swipe) {
            data.change(b[0]);
            delete data.drag;
            c[1].add(P.update);
            return c[1].play();
          }
          d = !data.active || data.active[0] !== b[0];
          e = d || Math.abs(a - c[1].progress()) > 0.001;
          if (d) {
            if (!c[0].paused()) {
              c[0].pause();
            }
            c[0].progress(0);
          }
          if (e) {
            if (!c[1].paused()) {
              c[1].pause();
            }
            c[1].progress(a);
          }
          data.active = b;
          break;
        case 'pointerup':
          if (!data.drag || data.swipe) {
            break;
          }
          event.stopPropagation();
          if (!(a = data.active)) {
            delete data.drag;
            break;
          }
          b = data.drag[a[1]].progress();
          if (b < 0.35) {
            data.drag[a[1]].reverse();
            delete data.drag;
            break;
          }
          data.change(a[0]);
          a = data.drag[a[1]];
          a.add(P.update);
          return a.play();
        case 'pointerover':
          if ((a = event.target.dataset.num) === undefined) {
            break;
          }
          event.stopPropagation();
          a = +a;
          nav.currentItem[nav.current] = a;
          cfg.data.btn['class'].toggle('active', function(el, index){
            return index === a;
          });
          true;
          break;
        case 'keydown':
          a = event.data.keys.indexOf(event.key);
          if (a < 0) {
            break;
          }
          event.preventDefault();
          event.stopImmediatePropagation();
          b = nav.currentItem[nav.current];
          c = cfg.data.btn;
          if (a) {
            a = b < c.length - 1 ? b + 1 : 0;
          } else {
            a = b > 0
              ? b - 1
              : c.length - 1;
          }
          nav.currentItem[nav.current] = a;
          c['class'].toggle('active', function(el, index){
            return index === a;
          });
          break;
        case 'click':
          event.stopPropagation();
          a = cfg.level - 1;
          b = event.target.dataset.id;
          M[a] = b;
          P.construct();
        }
        break;
      case 'console':
        switch (nav.id) {
        case 'menu':
          !data.change && (data.change = function(id){
            var c, a, b, d;
            c = cfg.level + 1;
            a = M.nav[c].current || 0;
            b = cfg.context.data.length - 1;
            if (id) {
              b = a < b ? a + 1 : 0;
            } else {
              b = a > 0 ? a - 1 : b;
            }
            M.nav[c].current = b;
            a = V.el.console.cfg.data.hover;
            b = V.el.menu.cfg.data.drag[id];
            c = [a[0].progress() > 0.0001, a[1].progress() > 0.0001];
            if (c[0] || c[1]) {
              d = b;
              b = new TimelineLite({
                paused: true,
                ease: Power3.easeInOut
              });
              if (c[0]) {
                b.add(a[0].reverse().timeScale(2, 0));
              }
              if (c[1]) {
                b.add(a[1].reverse().timeScale(2, 0));
              }
              b.add(d.play(0));
            }
            b.add(P.update);
            return b.play();
          });
          switch (event.type) {
          case 'pointerover':
            event.stopPropagation();
            a = V.el.console.cfg.data.hover;
            b = event.data.id === 'left' ? 0 : 1;
            a[b].play();
            break;
          case 'pointerout':
            event.stopPropagation();
            a = V.el.console.cfg.data.hover;
            b = event.data.id === 'left' ? 0 : 1;
            a[b].reverse();
            break;
          case 'click':
            event.stopPropagation();
            a = event.data.id === 'left' ? 0 : 1;
            return data.change(a);
          case 'keydown':
            a = event.data.keys.indexOf(event.key);
            if (a < 0) {
              break;
            }
            event.preventDefault();
            event.stopImmediatePropagation();
            if (a < 2) {
              return data.change(a);
            }
            for (i$ = 0, len$ = (ref$ = cfg.context.cfg.data.btn).length; i$ < len$; ++i$) {
              a = ref$[i$];
              if (a['class'].has('active')) {
                break;
              }
            }
            a = a.dataset.id;
            M[cfg.level] = a;
            P.construct();
          }
        }
      }
      return false;
    }
  };
  if (M && V && P) {
    return P.init();
  }
});
function import$(obj, src){
  var own = {}.hasOwnProperty;
  for (var key in src) if (own.call(src, key)) obj[key] = src[key];
  return obj;
}